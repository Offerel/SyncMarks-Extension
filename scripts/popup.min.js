function cSearch(){let e=document.getElementById("bookmarks");for(;e.firstChild;)e.removeChild(e.firstChild);for(;clone.firstChild;)e.appendChild(clone.firstChild);clone=e.cloneNode(!0)}function addClick(){document.querySelectorAll(".file").forEach(function(e){e.addEventListener("mouseup",function(e){window.open(e.target.dataset.url,"_blank","noopener,noreferrer")},!1)})}function urlExists(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){let t=e[0].url,o=!1,n=document.querySelectorAll(".file");for(let e=0;e<n.length;e++)if(bmURL=n[e].children[0].dataset.url,t===bmURL){o=!0;break}o?(document.getElementById("svgfilled").style.display="inline",document.getElementById("svgoutline").style.display="none"):(document.getElementById("svgfilled").style.display="none",document.getElementById("svgoutline").style.display="inline")})}function popupMessage(e,t){let o=document.getElementById("popupMessage");o.innerText=e,o.className="show "+t,setTimeout(function(){o.classList.remove("show"),chrome.storage.local.remove("popup"),chrome.action.setBadgeText({text:""})},1e4)}function addBookmark(){chrome.storage.local.get(null,function(e){chrome.permissions.getAll(function(t){e.direct||!t.permissions.includes("bookmarks")?(chrome.runtime.sendMessage({action:"bookmarkTab"}),window.close()):chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.bookmarks.create({title:e[0].title,url:e[0].url},function(e){window.close()})})})})}var clone;chrome.storage.local.get(null,function(e){let t="Bearer "+btoa(encodeURIComponent(JSON.stringify({client:e.uuid,token:e.token})));fetch(e.instance+"?t="+Math.random().toString(24).substring(2,12),{method:"GET",cache:"no-cache",referrerPolicy:"no-referrer",headers:{Authorization:t}}).then(e=>{let t=e.headers.get("X-Request-Info");return null!=t&&chrome.storage.local.set({token:t}),e.text()}).then(e=>{let t=new DOMParser,o=t.parseFromString(e,"text/html"),n=document.getElementById("bookmarks");for(clone=o.getElementById("bookmarks").cloneNode(!0);clone.firstChild;)n.appendChild(clone.firstChild);addClick(),urlExists(),clone=document.getElementById("bookmarks").cloneNode(!0)}).catch(e=>{console.error(e),chrome.runtime.sendMessage({action:"changeIcon",data:"error"})})}),search=document.getElementById("search"),document.getElementById("settings").addEventListener("click",function(){chrome.runtime.openOptionsPage()}),document.getElementById("addbm").addEventListener("click",addBookmark),chrome.storage.local.get(null,function(e){void 0!==e.popup&&popupMessage(e.popup.message,e.popup.mode)}),search.addEventListener("input",function(e){let t=e.currentTarget.value,o=document.querySelectorAll("#bookmarks li.file"),n=document.getElementById("bookmarks");if(""===e.currentTarget.value)cSearch(),addClick();else{for(;n.firstChild;)n.removeChild(n.firstChild);o.forEach(e=>{n.appendChild(e),e.innerText.toUpperCase().includes(t.toUpperCase())||e.firstChild.dataset.url.toUpperCase().includes(t.toUpperCase())?(e.style.display="block",e.style.paddingLeft="20px"):e.style.display="none"})}});